<!DOCTYPE html>
<html>
<head>
<title>Simple Web Data Connector</title>
<script src="https://tableau.github.io/webdataconnector/lib/jquery.min.js"></script>
<script src="https://tableau.github.io/webdataconnector/lib/tableauwdc-2.3.0.js"></script>
</head>
<body>
<h1>Simple Web Data Connector</h1>
<form>
<label for="url">Data Source URL:</label>
<input type="text" id="url" value="https://matokeo.necta.go.tz/results/2024/csee/CSEE2024/CSEE2024.htm" />
<button id="submitButton">Submit</button>
</form>

<script>
var myConnector = tableau.makeConnector();

myConnector.getSchema = function(schemaCallback) {
var cols = [
{ id: "id", dataType: tableau.dataTypeEnum.string },
{ id: "name", dataType: tableau.dataTypeEnum.string },
{ id: "value", dataType: tableau.dataTypeEnum.float }
];

var tableSchema = {
id: "myData",
alias: "My Data",
columns: cols
};

schemaCallback([tableSchema]);
};

myConnector.getData = function(table, doneCallback) {
var url = document.getElementById("url").value; // Get the URL from the input
console.log("Fetching data from URL:", url); // Log the URL being fetched

$.getJSON(url)
.done(function(data) {
console.log("Data retrieved:", data); // Log the retrieved data
var tableData = [];

// Process the data and populate tableData
data.forEach(function(item) {
tableData.push({
id: item.id, // Adjust based on your data structure
title: item.title, // Example field from the sample API
body: item.body // Example field from the sample API
});
});

table.appendRows(tableData); // Append the rows to the table
doneCallback(); // Signal that data retrieval is complete
})
.fail(function(jqXHR, textStatus, errorThrown) {
console.error("Failed to fetch data from the URL:", textStatus, errorThrown); // Log error if fetching fails
});
};
</script>
</body>
</html>
